---
# Define caddyserver defaults
caddy_group: caddy
caddy_user: caddy
caddy_logrotate_days: 28
caddy_default_http_port: 80
caddy_config: |
  {
    auto_https off
    storage file_system {
      root /var/lib/caddy/.storage
    }
    order cgi last
  }
  :80 {
    root * /var/www/
    file_server
    metrics /metrics
    log {
      format json
      output file /var/log/caddy/access.log
    }
    @forbidden {
      remote_ip 172.0.0.0/8
    }
    respond @forbidden You are blocked to access the Webserver 403
    @allowed {
      not remote_ip 192.168.0.0/16
    }
    respond @allowed "Not on allowed list" 403
    redir /proxypac/proxy.pac /proxy.pac 301
    redir /proxypac/wpad.dat  /wpad.dat  301
    route {
      header /proxy.pac Content-Type "application/x-ns-proxy-autoconfig"
      header /wpad.dat  Content-Type "application/x-ns-proxy-autoconfig"
    }
    @basicauthpath path /var/www
    basicauth @basicauthpath {
      caddyserver wek02Zi9FdE11 # generate pass with caddy hash-password
    }
  }
  :8081 {
    root * /var/www/cgi-bin
    metrics /metrics
    log {
      format json
      output file /var/log/caddy/access_cgi.log
    }
    cgi /cgi-bin/* /var/www/cgi-bin/squidguard.cgi {
      script_name /cgi-bin/squidguard.cgi
    }
  }